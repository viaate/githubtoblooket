<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quizlet to Blooket Converter</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Titan+One&display=swap" rel="stylesheet">
  <style>
    :root {
      --blooket-teal: #0bc2cf;
      --blooket-teal-dark: #099aa3;
      --blooket-yellow: #FFD700;
      --blooket-orange: #FFA500;
      --blooket-white: #ffffff;
      --blooket-gray: #f4f4f4;
      --blooket-text: #333333;
      --blooket-text-light: #666666;
    }
    
    * {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background-color: var(--blooket-gray);
      color: var(--blooket-text);
      line-height: 1.6;
    }
    
    .blooket-header {
      background-color: var(--blooket-teal);
      color: white;
      padding: 30px 20px;
      text-align: center;
      font-family: 'Titan One', sans-serif;
      font-size: 2.5em;
      text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }
    
    .blooket-main {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: white;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .blooket-input-group {
      margin-bottom: 25px;
    }
    
    .blooket-label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--blooket-text);
      font-size: 1.1em;
    }
    
    .blooket-textarea {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      font-family: 'Poppins', sans-serif;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    
    .blooket-textarea:focus {
      outline: none;
      border-color: var(--blooket-teal);
      box-shadow: 0 0 0 3px rgba(11, 194, 207, 0.1);
    }
    
    .blooket-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    
    .blooket-btn {
      background-color: var(--blooket-teal);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      box-shadow: 0 4px 15px rgba(11, 194, 207, 0.3);
    }
    
    .blooket-btn:hover {
      background-color: var(--blooket-teal-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(11, 194, 207, 0.4);
    }
    
    .blooket-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .blooket-btn-secondary {
      background-color: #f8f9fa;
      color: var(--blooket-text);
      border: 2px solid #ddd;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .blooket-btn-secondary:hover {
      background-color: #e9ecef;
      border-color: #bbb;
    }
    
    .blooket-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .blooket-table th {
      background-color: var(--blooket-teal);
      color: white;
      padding: 15px 12px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
    }
    
    .blooket-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }
    
    .blooket-table tr:hover {
      background-color: #f8f9fa;
    }
    
    .blooket-preview {
      background-color: white;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .blooket-preview h2 {
      color: var(--blooket-teal);
      font-family: 'Titan One', sans-serif;
      font-size: 1.8em;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .blooket-footer {
      text-align: center;
      padding: 20px;
      background-color: var(--blooket-teal);
      color: white;
      font-size: 14px;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .success-message {
      background-color: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      border: 1px solid #c3e6cb;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="blooket-header">
    Quizlet to Blooket Converter
  </header>

  <!-- Main Content -->
  <main class="blooket-main">
    <div class="blooket-input-group">
      <label for="quizletInput" class="blooket-label">
        Paste your Quizlet set text below:
      </label>
      <textarea 
        id="quizletInput" 
        rows="15" 
        class="blooket-textarea" 
        placeholder="Copy and paste your full Quizlet text here... (Ctrl+V or Cmd+V)"
      ></textarea>
      <p style="color: var(--blooket-text-light); font-size: 14px; margin-top: 8px;">
        ðŸ’¡ Tip: Copy the entire Quizlet page content for best results
      </p>
    </div>
    
    <div class="blooket-buttons">
      <button id="generate" class="blooket-btn">
        <span id="generateText">Generate Blooket CSV</span>
        <div id="generateSpinner" class="loading-spinner" style="display: none;"></div>
      </button>
      <button id="clear" class="blooket-btn blooket-btn-secondary">
        Clear
      </button>
    </div>
  </main>

  <!-- Preview Section -->
  <div id="previewContainer" class="blooket-preview hidden" style="max-width: 1200px; margin: 20px auto;">
    <h2>
      Preview Your Blooket Set
    </h2>
    <div style="overflow-x: auto;">
      <table class="blooket-table">
        <thead>
          <tr id="previewHeaders">
            <!-- Headers will be populated by JavaScript -->
          </tr>
        </thead>
        <tbody id="previewTable"></tbody>
      </table>
    </div>
    <div class="success-message">
      âœ… Your CSV is ready for import into Blooket!
    </div>
  </div>

<script>
let templateData = null;
let templateHeaders = [];

// Load the template structure directly (no external file needed)
function loadEmbeddedTemplate() {
  try {
    // Use the official Blooket template structure
    templateHeaders = [
      "Question #",
      "Question Text", 
      "Answer 1",
      "Answer 2",
      "Answer 3 (Optional)",
      "Answer 4 (Optional)",
      "Time Limit (sec)",
      "Correct Answer(s)"
    ];
    
    templateData = []; // Empty data array
    
    console.log("âœ… Template loaded successfully");
    
    // Update preview table headers
    const previewHeaders = document.querySelector("#previewHeaders");
    previewHeaders.innerHTML = "";
    templateHeaders.forEach(header => {
      const th = document.createElement("th");
      th.textContent = header;
      previewHeaders.appendChild(th);
    });
  } catch (error) {
    console.error("Error loading template:", error);
    alert("Error initializing template structure.");
  }
}

function cleanLines(lines) {
  // Remove empty lines and noise
  const noisePatterns = [
    /^Profile Picture$/i,
    /^Students also studied$/i,
    /^Mastered/i,
    /^Still learning/i,
    /^Select/i,
    /^Practice questions/i,
    /^[0-9]+ \/ [0-9]+$/, // e.g., 20 / 53
    /^[0-9]+ studiers today$/i,
    /^Flashcards$/i,
    /^Learn$/i,
    /^Test$/i,
    /^Blocks$/i,
    /^Blast$/i,
    /^Match$/i,
    /^Your stats$/i,
    /^Search for flashcards$/i,
    /^Try free upgrade$/i,
    /^About us$/i,
    /^Home$/i,
    /^Notifications$/i,
    /^New folder$/i,
    /^Â©/i
  ];

  return lines.map(l => l.trim()).filter(l => l && !noisePatterns.some(p => p.test(l)));
}

function extractPairs(lines) {
  const pairs = [];
  for (let i = 0; i < lines.length - 1; i++) {
    const term = lines[i];
    const def = lines[i+1];
    // Consider as term/definition if both are non-empty and contain letters
    if (/[A-Za-zÃ€-Ã¿0-9]/.test(term) && /[A-Za-zÃ€-Ã¿0-9]/.test(def)) {
      pairs.push([term, def]);
      i++; // Skip next line since it's used as definition
    }
  }
  return pairs;
}

// Load template automatically when page loads
document.addEventListener(
